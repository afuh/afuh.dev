---
import { Picture } from '@astrojs/image/components'
import { marked } from 'marked'
import { getProjects } from '../lib/contentful'
import Page, { SEO } from '../layouts/Page.astro'
import MarkdownSection from '../components/MarkdownSection.astro'

type Props = {
  title: string
  content: string
  url: string
  codeUrl: string
  imageUrl: string
  seo: SEO
}

export const getStaticPaths = async () => {
  const projects = await getProjects()

  return projects.map((project) => ({
    params: { slug: project.slug },
    props: {
      title: project.title,
      content: marked.parse(project.content),
      url: project.url,
      codeUrl: project.codeUrl,
      imageUrl: project.imageUrl,
      seo: project.seo,
    },
  }))
}

const { title, content, url, codeUrl, imageUrl, seo } = Astro.props
const MAX_WIDTH = 480
---

<Page title={title} seo={seo}>
  <article>
    <section class="image-wrapper">
      <Picture src={imageUrl} alt={title} widths={[200, 400, MAX_WIDTH]} aspectRatio="16:9" sizes={`${MAX_WIDTH}px`} />
    </section>
    <section class="links-wrapper">
      <a class="link-strong" href={url}>Live</a>
      <a class="link-strong" href={codeUrl}>Code</a>
    </section>
    <MarkdownSection set:html={content} />
    <footer>
      <hr />
      <a class="link-strong" href="/">afuh.dev</a>
    </footer>
  </article>
</Page>

<style define:vars={{ maxWidth: `${MAX_WIDTH}px` }}>
  .markdown-section,
  .links-wrapper {
    margin-bottom: 32px;
  }

  hr,
  .image-wrapper {
    margin-bottom: 16px;
  }

  /* https://github.com/withastro/astro/pull/4797 */
  .image-wrapper,
  .image-wrapper img {
    aspect-ratio: 16/9;
    width: 100%;
  }

  .image-wrapper {
    position: relative;
    border-radius: 4px;
    overflow: hidden;
    max-width: var(--maxWidth);

    @media (max-width: 30em) {
      max-width: inherit;
    }
  }

  .image-wrapper::after {
    content: '';
    position: absolute;
    width: 100%;
    height: 100%;
    box-shadow: inset -2px 4px 10px rgba(0, 0, 0, 0.8);
    top: 0;
    left: 0;
  }

  .links-wrapper {
    display: flex;
  }

  .links-wrapper a {
    margin-right: 16px;
  }

  footer hr {
    display: block;
    height: 1px;
    background-color: var(--theme-border);
    border-width: 0;
  }
</style>
